<!DOCTYPE html>
<html>
<head>
  <title>WebGL Example</title>
  <meta charset="UTF-8" />
</head>
<body>
  <canvas id="game" width="640" height="480"></canvas>
  <script src="lib/gl-matrix-min.js"></script>
  <script src="app.js"></script>
  <script>
    function init() {
      const canvas = document.getElementById("game");
      const gl = canvas.getContext("webgl");
      if (gl === null) {
        alert(
          "Unable to initialize WebGL. Your browser or machine may not support it."
        );
        return;
      }

      const vsSource = `
        attribute vec4 aVertexPosition;
        attribute vec4 aVertexColor;

        uniform mat4 uModelViewMatrix;
        uniform mat4 uProjectionMatrix;
        
        varying lowp vec4 vColor;

        void main() {
          gl_Position = uProjectionMatrix * uModelViewMatrix * aVertexPosition;
          vColor = aVertexColor;
        }
      `;

      const fsSource = `
        varying lowp vec4 vColor;
        void main() {
          gl_FragColor = vColor;
        }
      `;

      const shaderProgram = initShaderProgram(gl, vsSource, fsSource);
      const programInfo = {
        program: shaderProgram,
        attribLocations: {
          vertexPosition: gl.getAttribLocation(
            shaderProgram,
            "aVertexPosition"
          ),
          vertexColor: gl.getAttribLocation(
            shaderProgram,
            "aVertexColor"
          )
        },
        uniformLocations: {
          projectionMatrix: gl.getUniformLocation(
            shaderProgram,
            "uProjectionMatrix"
          ),
          modelViewMatrix: gl.getUniformLocation(
            shaderProgram,
            "uModelViewMatrix"
          )
        }
      };

      const buffers = initBuffers(gl);
      var then = 0;

      // Draw the scene repeatedly
      function render(now) {
        now *= 0.001;  // convert to seconds
        const deltaTime = now - then;
        then = now;

        drawScene(gl, programInfo, buffers, deltaTime);

        requestAnimationFrame(render);
      }
      requestAnimationFrame(render);
    }

    window.onload = init;
  </script>
</body>
</html>
